--- RUN: main\tests_organized\functional\test_password_reset.py
--- CMD: C:\Users\hemja\OneDrive\Desktop\Last Cleanup\.venv\Scripts\python.exe "C:\Users\hemja\OneDrive\Desktop\Last Cleanup\main\tests_organized\functional\test_password_reset.py"
--- OUTPUT ---
🔑 TESTING PASSWORD RESET SYSTEM
==================================================

1️⃣ Testing Password Reset Token Model:
✅ Found existing test user: password_test_user
✅ Token created successfully
   Token: f57f85d2-2394-4584-aef4-afdff3960f85
   User: password_test_user
   Expires: 2025-10-13 18:45:14.940630+00:00
   Is expired: False
   Is used: False

2️⃣ Testing Token Expiry Logic:
✅ Expired token test:
   Expires at: 2025-10-13 17:15:14.946775+00:00
   Current time: 2025-10-13 17:45:14.949928+00:00
   Is expired: True
✅ Expiry logic working correctly

3️⃣ Available Users for Testing:
👥 Users with email addresses (22):
   📧 vendor1 (vendor1@example.com) - 0 tokens
   📧 vendor2 (vendor2@example.com) - 0 tokens
   📧 vendor3 (vendor3@example.com) - 0 tokens
   📧 buyer1 (buyer1@example.com) - 0 tokens
   📧 buyer2 (buyer2@example.com) - 0 tokens

4️⃣ Testing URL Patterns:
📍 Password Reset URLs:
   Request: http://127.0.0.1:8000/password-reset/
   Confirm: http://127.0.0.1:8000/password-reset/f57f85d2-2394-4584-aef4-afdff3960f85/

5️⃣ Checking Template Files:
❌ password_reset_request.html - Missing!
❌ password_reset_confirm.html - Missing!

6️⃣ Email Configuration Check:
   EMAIL_BACKEND: django.core.mail.backends.console.EmailBackend
   EMAIL_HOST: smtp.gmail.com
   EMAIL_PORT: 587
   DEFAULT_FROM_EMAIL: noreply@himalayanecommerce.com

7️⃣ Security Features Implemented:
   ✅ UUID-based tokens (non-guessable)
   ✅ Token expiration (1 hour)
   ✅ Single-use tokens (marked as used)
   ✅ Email validation before sending
   ✅ Automatic token invalidation
   ✅ HTML and plain text email support
   ✅ Secure password strength requirements
   ✅ Password confirmation validation
   ✅ User feedback and error handling

8️⃣ MANUAL TESTING INSTRUCTIONS:
===================================
🔍 Step-by-step testing:
1. Visit: http://127.0.0.1:8000/login/
2. Click 'Forgot your password?' link
3. Enter email address of existing user
4. Check email for reset link (if email configured)
5. Click reset link to set new password
6. Test login with new password

📧 Email Testing:
- Configure email settings in project_settings.py
- For testing, you can use console email backend:
  EMAIL_BACKEND = 'django.core.mail.backends.console.EmailBackend'

🔐 Test Cases to Verify:
   1. Valid email address → Reset link sent
   2. Invalid email address → Security message (no reveal)
   3. Expired token → Error message and redirect
   4. Used token → Error message and redirect
   5. Strong password → Accepted
   6. Weak password → Rejected with feedback
   7. Mismatched passwords → Validation error
   8. Successful reset → Login with new password

🧹 Cleaning up test tokens...
   Deleted 2 test tokens

✅ PASSWORD RESET SYSTEM TEST COMPLETE!
🌐 Ready for testing at: http://127.0.0.1:8000/password-reset/

--- EXIT CODE: 0
